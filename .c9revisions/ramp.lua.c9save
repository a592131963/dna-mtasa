{"ts":1350329494502,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"local gRoot = getRootElement()\r\nlocal g_Root = gRoot\r\nlocal gMe = getLocalPlayer()\r\nlocal gResourceRoot = getResourceRootElement(getThisResource())\r\nlocal theRamps = {}\r\n\r\naddEvent ( \"vehicleramps_SpawnRamp\", true )\r\naddEventHandler ( \"vehicleramps_SpawnRamp\", gRoot,\r\n\tfunction ( mode, returnedData )\r\n\t\t--outputChatBox ( \"A RAMP WAS MADE BY \" .. getPlayerName(source) )\r\n\t\t\r\n\t\tif ( theRamps[source] ) then\r\n\t\t\t--outputChatBox ( \"Destroying the ramps table\" )\r\n\t\t\tdestroyElement(theRamps[source])\r\n\t\t\ttheRamps[source] = false\r\n\t\tend\r\n\t\r\n\t\tlocal parentUnit = createElement(\"myRamps\" .. getPlayerID(source))\r\n\t\ttheRamps[source] = parentUnit\r\n\t\t\r\n\t\tif ( mode == \"1\" ) then\r\n\t\t\tif ( #returnedData == 6 ) then\r\n\t\t\t\tspawnRamp ( source, returnedData[1], returnedData[2], returnedData[3], returnedData[4], returnedData[5], returnedData[6], 1632  )\r\n\t\t\tend\r\n\t\telseif ( mode == \"1s\" ) then\r\n\t\t\tspawnRamp ( source, returnedData[1], returnedData[2], returnedData[3], 0, 0, 0, 1632  )\r\n\t\t\tspawnRamp ( source, returnedData[4], returnedData[5], returnedData[6], 0, 0, 90, 1632  )\r\n\t\t\tspawnRamp ( source, returnedData[7], returnedData[8], returnedData[9], 0, 0, 180, 1632  )\r\n\t\t\tspawnRamp ( source, returnedData[10], returnedData[11], returnedData[12], 0, 0, 270, 1632  )\r\n\t\telseif ( mode == \"2\" ) then\r\n\t\t\tif ( #returnedData == 9 ) then\r\n\t\t\t\tspawnRamp ( source, returnedData[1], returnedData[2], returnedData[3], returnedData[7], returnedData[8], returnedData[9], 1632 )\r\n\t\t\t\tspawnRamp ( source, returnedData[4], returnedData[5], returnedData[6], returnedData[7], returnedData[8], returnedData[9], 1632  )\r\n\t\t\tend\r\n\t\telseif ( mode == \"3\" ) then\r\n\t\t\tif ( #returnedData == 9 ) then\r\n\t\t\t\tlocal thisRamp = spawnRamp ( source, returnedData[1], returnedData[2], returnedData[3], returnedData[7], returnedData[8], returnedData[9], 1632 )\r\n\t\t\t\tlocal rx, ry, rz = getObjectRotation ( thisRamp )\r\n\t\t\t\tspawnRamp ( source, returnedData[4], returnedData[5], returnedData[6], rx + 22, returnedData[8], returnedData[9], 1632  )\r\n\t\t\tend\r\n\t\telseif ( mode == \"5\" ) then\r\n\t\t\tif ( #returnedData == 6 ) then\r\n\t\t\t\tspawnRamp ( source, returnedData[1], returnedData[2], returnedData[3], 0, 0, returnedData[6], 13592  )\r\n\t\t\tend\r\n\t\telseif ( mode == \"6\" ) then\r\n\t\t\tif ( #returnedData == 6 ) then\r\n\t\t\t\tspawnRamp ( source, returnedData[1], returnedData[2], returnedData[3], 0, 0, returnedData[6], 13641  )\r\n\t\t\tend\r\n\t\telseif ( mode == \"custom\" ) then\r\n\t\t\tif ( #returnedData == 7 ) then\r\n\t\t\t\tspawnRamp ( source, returnedData[1], returnedData[2], returnedData[3], 0, 0, returnedData[6], returnedData[7]  )\r\n\t\t\tend\r\n\t\tend\r\n\tend\r\n)\r\n\r\naddEventHandler ( \"onClientResourceStart\", gResourceRoot, function(name)\r\n\t--outputChatBox ( \"Client Script Started\" )\r\n\t\toutputChatBox ( \"Client Script Started\" )\r\n\t\t--bindKey ( \"1\", \"down\", workOutRamps, 1 )\r\n\t\t--bindKey ( \"2\", \"down\", workOutRamps, 2 )\r\n\t\tbindKey ( \"3\", \"down\", workOutRamps )\r\n\t\t--bindKey ( \"5\", \"down\", workOutRamps, 5 )\r\n\t\t--bindKey ( \"6\", \"down\", workOutRamps, 6 )\r\n\r\nend)\r\n\r\nfunction workOutRamps()\r\n\tlocal playerVehicle = getPlayerOccupiedVehicle(getLocalPlayer())\r\n\tif ( playerVehicle ) then\r\n\t\tlocal PV = getVehicleController(playerVehicle)\r\n\t\tif ( PV ~= getLocalPlayer() ) then\r\n\t\t\toutputChatBox ( \"Your not the driver!\" )\r\n\t\t\treturn\r\n\t\tend \r\n\r\n\t\tif ( theRamps[gMe] ) then\r\n\t\t\t--outputChatBox ( \"Destroying the ramps table\" )\r\n\t\t\tdestroyElement(theRamps[gMe])\r\n\t\t\ttheRamps[gMe] = false\r\n\t\tend\r\n\t\r\n\t\tlocal parentUnit = createElement(\"myRamps\" .. getPlayerID(gMe))\r\n\t\ttheRamps[gMe] = parentUnit\r\n\t\t\t\r\n\t\tlocal distance = 20\r\n\t\tlocal returnedData = {}\r\n\t\tlocal vehX, vehY, vZ = getElementPosition(playerVehicle)\r\n\t\tlocal rotX, rotY, rotZ = getVehicleRotation(playerVehicle)\r\n\t\r\n\t\tlocal ramp1X, ramp1Y = vehX + distance*math.cos(math.rad(rotZ+90)), vehY + distance*math.sin(math.rad(rotZ+90))\r\n\t\tlocal ramp2X, ramp2Y = vehX + (distance+5)*math.cos(math.rad(rotZ+90)), vehY + (distance+5)*math.sin(math.rad(rotZ+90))\r\n\t\tlocal ramp1Z = getGroundForCoords(ramp1X, ramp1Y, vZ)\r\n\t\tlocal ramp2Z = getGroundForCoords(ramp1X, ramp1Y, vZ)\r\n\t\t\r\n\t\tif ( doneOnce ) then\r\n\t\t\tif ( lastx == ramp1X ) then\r\n\t\t\t\tif ( lasty == ramp1Y ) then\r\n\t\t\t\t\tramp1Z = ramp1Z - 0.78579690039\r\n\t\t\t\tend\r\n\t\t\telse\r\n\t\t\t\tdoneOnce = false\r\n\t\t\tend\r\n\t\telse\r\n\t\t\tdoneOnce = true\r\n\t\tend\r\n\t\tlastx = ramp1X\r\n\t\tlasty = ramp1Y\r\n\t\t\r\n\t\treturnedData[1] = ramp1X\r\n\t\treturnedData[2] = ramp1Y\r\n\t\treturnedData[3] = ramp1Z + 1\r\n\t\treturnedData[4] = ramp2X\r\n\t\treturnedData[5] = ramp2Y\r\n\t\treturnedData[6] = ramp2Z + 4.5\r\n\t\treturnedData[7] = rotX\r\n\t\treturnedData[8] = rotY\r\n\t\treturnedData[9] = rotZ\r\n\t\tlocal thisRamp = spawnRamp ( gMe, returnedData[1], returnedData[2], returnedData[3], returnedData[7], returnedData[8], returnedData[9], 1632 )\r\n\t\tlocal rx, ry, rz = getObjectRotation ( thisRamp )\r\n\t\tspawnRamp ( gMe, returnedData[4], returnedData[5], returnedData[6], rx + 22, returnedData[8], returnedData[9], 1632  )\r\n\t\ttriggerServerEvent ( \"vehicleramps_PlayerSpawnedRamp\", getLocalPlayer(), mode, returnedData )\r\n\tend\r\nend\r\n\r\nfunction spawnRamp ( player, x, y, z, rx, ry, rz, model )\r\n\t--outputDebugString ( \"Attempting to create a ramp @ \" .. tostring(x) .. \" \" .. tostring(y) .. \" \" .. tostring(z) .. \" r @ \" .. tostring(rx) .. \" \" .. tostring(ry) .. \" \" .. tostring(rz) )\r\n\tlocal dontCreateRamp = checkRampForObstructions(x, y, z)\r\n\t--outputChatBox ( \"Ramps Table = \" .. tostring(theRamps[player]) )\r\n\tif ( theRamps[player] ) then\r\n\t\tparentUnit = theRamps[player]\r\n\tend\r\n\tif ( dontCreateRamp == false ) then\r\n\t\tlocal thisRamp = createObject ( model, x, y, z, rx, 0, rz )\r\n\t\tsetElementParent ( thisRamp, parentUnit )\r\n\t\treturn thisRamp\r\n\tend\r\nend\r\n\r\naddEventHandler ( \"onClientVehicleExit\", g_Root,\r\n\tfunction ( player, seat )\r\n\t\tif ( theRamps[player] ) then\r\n\t\t\tdestroyElement ( theRamps[player] )\r\n\t\tend\r\n\tend\r\n)\r\n\r\naddEventHandler ( \"onClientPlayerQuit\", g_Root,\r\n\tfunction ( reason )\r\n\t\tif ( theRamps[source] ) then\r\n\t\t\tdestroyElement ( theRamps[source] )\r\n\t\tend\r\n\tend\r\n)\r\n\r\nfunction getPlayerID (player)\r\n\tfor k,v in ipairs(getElementsByType(\"player\")) do\r\n\t\tif ( v == player ) then\r\n\t\t\treturn k\r\n\t\tend\r\n\tend\r\n\treturn 0\r\nend\r\n\r\nfunction getGroundForCoords(x, y, z)\r\n\tlocal col, retx, rety, retz, element = processLineOfSight ( x, y, z, x, y, z-500 )\r\n\tif ( col ) then\r\n\t\tlocal watrPos = getWaterLevel ( x, y, z )\r\n\t\tif ( watrPos ~= false ) then\r\n\t\t\tif ( tonumber(watrPos) > tonumber(retz) ) then\r\n\t\t\t\treturn watrPos + 0.1\r\n\t\t\telse\r\n\t\t\t\treturn retz\r\n\t\t\tend\r\n\t\telse\r\n\t\t\treturn retz\r\n\t\tend\r\n\telse\r\n\t\tlocal watrPos = getWaterLevel ( x, y, z )\r\n\t\tif ( watrPos ~= false ) then\r\n\t\t\treturn watrPos + 0.1\r\n\t\telse\r\n\t\t\treturn z\r\n\t\tend\r\n\tend\r\nend\r\n\r\nfunction checkRampForObstructions ( x, y, z )\r\n\tlocal dontCreate = false\r\n\tfor k,v in ipairs(getElementsByType(\"player\")) do\r\n\t\tif ( v ~= getLocalPlayer() ) then\r\n\t\t\tlocal thisX, thisY, thisZ = getElementPosition(v)\r\n\t\t\tlocal thisDistance = getDistanceBetweenPoints3D ( x, y, z, thisX, thisY, thisZ )\r\n\t\t\tif ( thisDistance < 8 ) then\r\n\t\t\t\tdontCreate = true\r\n\t\t\tend\r\n\t\tend\r\n\tend\r\n\treturn dontCreate\r\nend"]],"start1":0,"start2":0,"length1":0,"length2":7004}]],"length":7004}
{"contributors":[],"silentsave":false,"ts":1350293474200,"patch":[[{"diffs":[[0,"rx, ry, rz = get"],[-1,"Objec"],[1,"Elemen"],[0,"tRotation ( this"]],"start1":1828,"start2":1828,"length1":37,"length2":38}]],"length":7005,"saved":false}
{"ts":1350293491673,"patch":[[{"diffs":[[0,"e = getP"],[-1,"layer"],[1,"ed"],[0,"Occupied"]],"start1":3032,"start2":3032,"length1":21,"length2":18}]],"length":7002,"saved":false}
{"ts":1350293510481,"patch":[[{"diffs":[[0,"tZ = get"],[-1,"Vehicle"],[1,"Element"],[0,"Rotation"]],"start1":3645,"start2":3645,"length1":23,"length2":23}]],"length":7002,"saved":false}
{"ts":1350293909207,"patch":[[{"diffs":[[0,"rz = get"],[-1,"Objec"],[1,"Elemen"],[0,"tRotatio"]],"start1":4712,"start2":4712,"length1":21,"length2":22}]],"length":7003,"saved":false}
