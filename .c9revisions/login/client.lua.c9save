{"ts":1350244802601,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"blackLoginScreen = true\t\t\t-- Set to 'true' to display a black screen to the player untill they log in or choose to play as a guest.\r\nenableKickPlayer = true\t\t\t-- Set whether to kick the player after they fail to login specified amount of times.\r\ndisallowLogout = false\t\t\t-- Set whether to show the userpanel to the players if they log out of their accounts.\r\nremoveBlackScreenTime = 3\t\t-- The time it takes for the black screen to dissapear - If you choose to display the black screen. [IN SECONDS]\r\nmaxLoginAttempts = 3 \t\t\t-- Set the maximum incorrect login attempts before the player gets kicked - If player kicking is enabled.\r\n-- Set the text you want displayed in the \"rules\" window here - use '\\n' to go into the next line\r\ninfoText = \"------ Rules ------ \\n\\n* No cheating!\\n* No insulting and spamming!\\n* No vehicle mods\\n\\nEdit the text however you like\\n\\n\\n\\n\\n\\n\\n\\nLogin panel by NeXTreme\"\r\n\r\n-- Screen and GUI window sizes\r\nscreenWidth,screenHeight = guiGetScreenSize()\r\nmainWidth,mainHeight = 749,472\r\nregWidth,regHeight = 439,344\r\n\r\n-- Generate the XML file name\r\nfunction getServerName()\r\n\ttriggerServerEvent(\"onClientLoginLoaded\",getLocalPlayer())\r\nend\r\naddEventHandler(\"onClientResourceStart\",getResourceRootElement(getThisResource()),getServerName)\r\n\r\nfunction setXmlFileName(sName)\r\n\txmlFileName = tostring(\"login_\"..sName..\".xml\")\r\n\tloginPanel()\r\nend\r\naddEvent(\"onGetServerData\",true)\r\naddEventHandler(\"onGetServerData\",getRootElement(),setXmlFileName)\r\n\r\naddEvent(\"onRequestIncreaseAttempts\",true)\r\naddEvent(\"onRequestDisplayPanel\",true)\r\n\r\nfunction loginPanel()\r\n\t\t-- Check if autologin is enabled - If yes, then log the player in, else create and show the userpanel\r\n\t\tlocal xmlFile = xmlLoadFile(xmlFileName)\r\n\t\tif xmlFile then\r\n\t\t\tstatus = xmlNodeGetAttribute(xmlFile,\"autologin\")\r\n\t\t\tif (status == \"true\") then\r\n\t\t\t\tlocal username = tostring(xmlNodeGetAttribute(xmlFile,\"username\"))\r\n\t\t\t\tlocal password = tostring(xmlNodeGetAttribute(xmlFile,\"password\"))\r\n\t\t\t\tif not (username == \"\") and not (password == \"\") then\r\n\t\t\t\t\ttriggerServerEvent(\"onRequestAutologin\",getLocalPlayer(),username,password)\r\n\t\t\t\tend\r\n\t\t\telse\r\n\t\t\t\tif blackLoginScreen == true then\r\n\t\t\t\t\tfadeCamera(false,0,0,0,0)\r\n\t\t\t\tend\r\n\t\t\t\tmainWindow = guiCreateWindow(screenWidth/2-mainWidth/2,screenHeight/2-mainHeight/2,mainWidth,mainHeight,\"Login panel\",false)\r\n\t\t\t\tguiWindowSetSizable(mainWindow,false)\r\n\r\n\t\t\t\tmInfo = guiCreateMemo(21,36,411,278,infoText,false,mainWindow)\r\n\t\t\t\tguiMemoSetReadOnly(mInfo,true)\r\n\r\n\t\t\t\teditUsername = guiCreateEdit(53,364,187,25,\"\",false,mainWindow)\r\n\t\t\t\tguiEditSetMaxLength(editUsername,30)\r\n\r\n\t\t\t\teditPassword = guiCreateEdit(53,421,187,25,\"\",false,mainWindow)\r\n\t\t\t\tguiEditSetMaxLength(editPassword,30)\r\n\t\t\t\tguiEditSetMasked(editPassword,true)\r\n\r\n\t\t\t\tlblUsername = guiCreateLabel(67,330,158,38,\"Username:\",false,mainWindow)\r\n\t\t\t\tguiLabelSetColor(lblUsername,0,85,255)\r\n\t\t\t\tguiLabelSetVerticalAlign(lblUsername,\"center\")\r\n\t\t\t\tguiLabelSetHorizontalAlign(lblUsername,\"center\",false)\r\n\t\t\t\tguiSetFont(lblUsername,\"default-bold-small\")\r\n\r\n\t\t\t\tlblPassword = guiCreateLabel(67,389,158,38,\"Password:\",false,mainWindow)\r\n\t\t\t\tguiLabelSetColor(lblPassword,0,85,255)\r\n\t\t\t\tguiLabelSetVerticalAlign(lblPassword,\"center\")\r\n\t\t\t\tguiLabelSetHorizontalAlign(lblPassword,\"center\",false)\r\n\t\t\t\tguiSetFont(lblPassword,\"default-bold-small\")\r\n\r\n\t\t\t\tbtnPlayAsGuest = guiCreateButton(548,368,168,74,\"Play as guest\",false,mainWindow)\r\n\t\t\t\tguiSetFont(btnPlayAsGuest,\"default-bold-small\")\r\n\r\n\t\t\t\tbtnLogin = guiCreateButton(280,368,242,74,\"Login\",false,mainWindow)\r\n\t\t\t\tguiSetFont(btnLogin,\"sa-header\")\r\n\r\n\t\t\t\tbtnToggleRegister = guiCreateButton(490,246,206,68,\"Register an account\",false,mainWindow)\r\n\t\t\t\tguiSetFont(btnToggleRegister,\"default-bold-small\")\r\n\r\n\t\t\t\tregisterWindow = guiCreateWindow(screenWidth/2-regWidth/2,screenHeight/2-regHeight/2,regWidth,regHeight,\"Registration\",false)\r\n\t\t\t\tguiWindowSetSizable(registerWindow,false)\r\n\r\n\t\t\t\teditRegistrationUsername = guiCreateEdit(98,138,242,25,\"\",false,registerWindow)\r\n\r\n\t\t\t\teditRegistrationPassword = guiCreateEdit(98,195,242,25,\"\",false,registerWindow)\r\n\t\t\t\tguiEditSetMasked(editRegistrationPassword,true)\r\n\r\n\t\t\t\teditRegistrationRepeatPassword = guiCreateEdit(99,252,242,25,\"\",false,registerWindow)\r\n\t\t\t\tguiEditSetMasked(editRegistrationRepeatPassword,true)\r\n\r\n\t\t\t\tlblRegister = guiCreateLabel(24,24,391,97,\"Register\",false,registerWindow)\r\n\t\t\t\tguiLabelSetColor(lblRegister,0,85,255)\r\n\t\t\t\tguiLabelSetVerticalAlign(lblRegister,\"center\")\r\n\t\t\t\tguiLabelSetHorizontalAlign(lblRegister,\"center\",false)\r\n\t\t\t\tguiSetFont(lblRegister,\"sa-gothic\")\r\n\r\n\t\t\t\tlblRUsername = guiCreateLabel(98,113,242,17,\"Username:\",false,registerWindow)\r\n\t\t\t\tguiLabelSetColor(lblRUsername,0,85,255)\r\n\t\t\t\tguiLabelSetVerticalAlign(lblRUsername,\"center\")\r\n\t\t\t\tguiLabelSetHorizontalAlign(lblRUsername,\"center\",false)\r\n\t\t\t\tguiSetFont(lblRUsername,\"default-bold-small\")\r\n\r\n\t\t\t\tlblRPassword = guiCreateLabel(98,171,242,17,\"Password:\",false,registerWindow)\r\n\t\t\t\tguiLabelSetColor(lblRPassword,0,85,255)\r\n\t\t\t\tguiLabelSetVerticalAlign(lblRPassword,\"center\")\r\n\t\t\t\tguiLabelSetHorizontalAlign(lblRPassword,\"center\",false)\r\n\t\t\t\tguiSetFont(lblRPassword,\"default-bold-small\")\r\n\r\n\t\t\t\tlblRepeatPassword = guiCreateLabel(98,230,242,17,\"Repeat password:\",false,registerWindow)\r\n\t\t\t\tguiLabelSetColor(lblRepeatPassword,0,85,255)\r\n\t\t\t\tguiLabelSetVerticalAlign(lblRepeatPassword,\"center\")\r\n\t\t\t\tguiLabelSetHorizontalAlign(lblRepeatPassword,\"center\",false)\r\n\t\t\t\tguiSetFont(lblRepeatPassword,\"default-bold-small\")\r\n\r\n\t\t\t\tbtnCancel = guiCreateButton(232,292,179,38,\"Cancel\",false,registerWindow)\r\n\t\t\t\tguiSetFont(btnCancel,\"default-bold-small\")\r\n\r\n\t\t\t\tbtnConfirmRegistration = guiCreateButton(29,292,179,38,\"Confirm & register!\",false,registerWindow)\r\n\t\t\t\tguiSetFont(btnConfirmRegistration,\"default-bold-small\")\r\n\r\n\t\t\t\tguiCreateStaticImage(440,23,300,225,\"logo.png\",false,mainWindow)\r\n\r\n\t\t\t\tguiSetVisible(mainWindow, true)\r\n\t\t\t\tguiSetVisible(registerWindow, false)\r\n\t\t\t\tguiSetInputEnabled(true)\r\n\t\t\t\tshowCursor(true)\r\n\t\t\t\taddEventHandler(\"onClientGUIClick\",btnLogin,onClickLogin)\r\n\t\t\t\taddEventHandler(\"onClientGUIClick\",btnToggleRegister,onClickRegisterToggle)\r\n\t\t\t\taddEventHandler(\"onClientGUIClick\",btnPlayAsGuest,onClickGuest)\r\n\t\t\t\taddEventHandler(\"onClientGUIClick\",btnConfirmRegistration,onClickRegisterConfirm)\r\n\t\t\t\taddEventHandler(\"onClientGUIClick\",btnCancel,onClickCancel)\r\n\t\t\t\taddEventHandler(\"onRequestIncreaseAttempts\",getRootElement(),increaseAttempts)\r\n\t\t\t\tattemptedLogins = 0\r\n\t\t\tend\r\n\t\t\txmlUnloadFile(xmlFile)\r\n\t\telse\r\n\t\t\txmlFileHandler(true)\r\n\t\tend\r\n\t\taddEventHandler(\"onRequestDisplayPanel\",getRootElement(),logoutHandler)\r\nend\r\n--addEventHandler(\"onClientResourceStart\",getResourceRootElement(getThisResource()),loginPanel)\r\n\r\n-- Disable autologin\r\nfunction removeAutoLogin()\r\n    local xmlFile = xmlLoadFile(xmlFileName)\r\n\tif xmlFile then\r\n\t\tlocal status = xmlNodeGetAttribute(xmlFile,\"autologin\")\r\n\t\tif status == \"true\" then\r\n\t\t\txmlNodeSetAttribute(xmlFile,\"autologin\",\"false\")\r\n\t\t\toutputChatBox(\"#0000FF* #FFFFFFAuto-login is now #FF0000DISABLED#FFFFFF!\",255,255,255,true)\r\n\t\t\txmlSaveFile(xmlFile)\r\n\t\t\txmlUnloadFile(xmlFile)\r\n\t\telse\r\n\t\t\toutputChatBox(\"#0000FF* #FFFFFFAuto-login is already #FF0000DISABLED#FFFFFF!\",255,255,255,true)\r\n\t\t\txmlUnloadFile(xmlFile)\r\n\t\tend\r\n\tend\r\nend\r\naddCommandHandler(\"disableauto\", removeAutoLogin)\r\n\r\n-- Enable autologin\r\nfunction addAutoLogin()\r\n    local xmlFile = xmlLoadFile(xmlFileName)\r\n\tif xmlFile then\r\n\t\tlocal status  = xmlNodeGetAttribute(xmlFile,\"autologin\")\r\n\t\tif status == \"false\" then\r\n\t\t\txmlNodeSetAttribute(xmlFile,\"autologin\",\"true\")\r\n\t\t\toutputChatBox(\"#0000FF* #FFFFFFAuto-login is now #00FF00ENABLED#FFFFFF! You will be automatically logged in every time you join the server.\",255,255,255,true)\r\n\t\t\tsetTimer(outputChatBox,1000,1,\"#0000FF* #FFFFFFTo #FF0000DISABLE#FFFFFF auto-login, use #ABCDEF/disableauto#FFFFFF!\",255,255,255,true)\r\n\t\t\txmlSaveFile(xmlFile)\r\n\t\t\txmlUnloadFile(xmlFile)\r\n\t\telse\r\n\t\t\toutputChatBox(\"#0000FF* #FFFFFFAuto-login is already #00FF00ENABLED#FFFFFF!\",255,255,255,true)\r\n\t\t\txmlUnloadFile(xmlFile)\r\n\t\tend\r\n\tend\r\nend\r\naddCommandHandler(\"enableauto\", addAutoLogin)\r\n\r\n-- LOGIN PLAYER\r\nfunction onClickLogin(button,state)\r\n\tif(button == \"left\" and state == \"up\") then\r\n\t\tif (source == btnLogin) then\r\n\t\t\tusername = guiGetText(editUsername)\r\n\t\t\tpassword = guiGetText(editPassword)\r\n\t\t\ttriggerServerEvent(\"onRequestLogin\",getLocalPlayer(),username,password,enableKickPlayer,attemptedLogins,maxLoginAttempts)\r\n\t\t\txmlFileHandler()\r\n\t\tend\r\n\tend\r\nend\r\n\r\n-- REGISTER PLAYER\r\nfunction onClickRegisterConfirm(button,state)\r\n\tif(button == \"left\" and state == \"up\") then\r\n\t\tif (source == btnConfirmRegistration) then\r\n\t\t\tusername = guiGetText(editRegistrationUsername)\r\n\t\t\tpassword = guiGetText(editRegistrationPassword)\r\n\t\t\tpasswordConfirm = guiGetText(editRegistrationRepeatPassword)\r\n\t\t\ttriggerServerEvent(\"onRequestRegister\",getLocalPlayer(),username,password,passwordConfirm)\r\n\t\tend\r\n\tend\r\nend\r\n\r\n-- Open registration window\r\nfunction onClickRegisterToggle(button,state)\r\n\tif(button == \"left\" and state == \"up\") then\r\n\t\tif (source == btnToggleRegister) then\r\n\t\t\tguiSetVisible(registerWindow, true)\r\n\t\t\tguiBringToFront(registerWindow)\r\n\t\t\tguiSetInputEnabled(true)\r\n\t\t\tshowCursor(true)\r\n\t\tend\r\n\tend\r\nend\r\n\r\n-- Cancel registration\r\nfunction onClickCancel(button,state)\r\n\tif(button == \"left\" and state == \"up\") then\r\n\t\tif (source == btnCancel) then\r\n\t\t\tguiSetVisible(mainWindow, true)\r\n\t\t\tguiSetVisible(registerWindow, false)\r\n\t\t\tguiSetInputEnabled(true)\r\n\t\t\tshowCursor(true)\r\n\t\tend\r\n\tend\r\nend\r\n\r\n-- Guest mode\r\nfunction onClickGuest(button,state)\r\n\tif(button == \"left\" and state == \"up\") then\r\n\t\tif (source == btnPlayAsGuest) then\r\n\t\t\tguiSetVisible(mainWindow, false)\r\n\t\t\tguiSetVisible(registerWindow, false)\r\n\t\t\tguiSetInputEnabled(false)\r\n\t\t\tshowCursor(false)\r\n\t\t\toutputChatBox(\"#0000FF* #FFFFFFYou've chosen to play as a #ABCDEFGUEST#FFFFFF!\",255,255,255,true)\r\n\t\t\tif blackLoginScreen == true then\r\n\t\t\t\tfadeCamera(true,removeBlackScreenTime)\r\n\t\t\tend\r\n\t\tend\r\n\tend\r\nend\r\n\r\n-- Show login window\r\nfunction showLoginWindow()\r\n\tguiSetVisible(mainWindow, true)\r\n\tguiSetVisible(registerWindow, false)\r\n\tguiSetInputEnabled(true)\r\n\tshowCursor(true)\r\nend\r\naddEvent(\"showLoginWindow\", true)\r\naddEventHandler(\"showLoginWindow\",getRootElement(),showLoginWindow)\r\n\r\n-- Hide login window\r\nfunction hideLoginWindow()\r\n\tguiSetInputEnabled(false)\r\n\tguiSetVisible(mainWindow, false)\r\n\tguiSetVisible(registerWindow, false)\r\n\tshowCursor(false)\r\n\tif blackLoginScreen == true then\r\n\t\tfadeCamera(true,removeBlackScreenTime)\r\n\tend\r\nend\r\naddEvent(\"hideLoginWindow\", true)\r\naddEventHandler(\"hideLoginWindow\", getRootElement(), hideLoginWindow)\r\n\r\n-- Hide register window\r\nfunction hideRegisterWindow()\r\n\tguiSetInputEnabled(true)\r\n\tguiSetVisible(mainWindow, true)\r\n\tguiSetVisible(registerWindow, false)\r\n\tshowCursor(true)\r\nend\r\naddEvent(\"hideRegisterWindow\", true)\r\naddEventHandler(\"hideRegisterWindow\", getRootElement(), hideRegisterWindow)\r\n\r\n-- Show login panel when a player logs out if 'dissalowLogout' is set to TRUE\r\nfunction logoutHandler()\r\n\tif (disallowLogout == true) then\r\n\t\tloginPanel()\r\n\t\tsetTimer(outputChatBox,600,1,\"#0000FF* #FFFFFFWarning! You have logged out. Please login again.\",255,255,255,true)\r\n\tend\r\nend\r\n\r\n-- XML File Handler\r\nfunction xmlFileHandler(gReturn)\r\n\tlocal xmlFile = xmlLoadFile(xmlFileName)\r\n\tif not xmlFile then\r\n\t\txmlFile = xmlCreateFile(xmlFileName,\"settings\")\r\n\t\txmlNodeSetAttribute(xmlFile,\"autologin\",\"false\")\r\n\tend\r\n\txmlNodeSetAttribute(xmlFile,\"username\",tostring(guiGetText(editUsername)))\r\n\txmlNodeSetAttribute(xmlFile,\"password\",tostring(guiGetText(editPassword)))\r\n\txmlSaveFile(xmlFile)\r\n\txmlUnloadFile(xmlFile)\r\n\tif (gReturn) then\r\n\t\tif (gReturn == true) then\r\n\t\t\tloginPanel()\r\n\t\telse\r\n\t\t\treturn\r\n\t\tend\r\n\tend\r\nend\r\n\r\n-- Increase Login Attepts\r\nfunction increaseAttempts()\r\n\tattemptedLogins = attemptedLogins+1\r\nend\r\n"]],"start1":0,"start2":0,"length1":0,"length2":11910}]],"length":11910}
