{"ts":1350244748925,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"-- Login handling\r\nfunction loginPlayer(username,password,enableKickPlayer,attemptedLogins,maxLoginAttempts)\r\n\tif not (username == \"\") then\r\n\t\tif not (password == \"\") then\r\n\t\t\tlocal account = getAccount ( username, password )\r\n\t\t\tif ( account ~= false ) then\r\n\t\t\t\tlogIn (source, account, password)\r\n\t\t\t\toutputChatBox (\"#0000FF* #FFFFFFYou have sucessfully logged in!\",source,255,255,255,true)\r\n\t\t\t\tsetTimer(outputChatBox,700,1,\"#0000FF* #FFFFFFTo enable auto-login, use #ABCDEF/enableauto#FFFFFF!\",source,255,255,255,true)\r\n\t\t\t\ttriggerClientEvent (source,\"hideLoginWindow\",getRootElement())\r\n\t\t\telse\r\n\t\t\t\tif enableKickPlayer == true then\r\n\t\t\t\t\tif (attemptedLogins >= maxLoginAttempts-1) then\r\n\t\t\t\t\t\toutputChatBox (\"#0000FF* #FFFFFFError! Wrong username and/or password!\",source,255,255,255,true)\r\n\t\t\t\t\t\tsetTimer(outputChatBox,500,1,\"#0000FF* #FFFFFFWarning! Maximum login attempts reached! [#008AFF\"..attemptedLogins+1 ..\"/\"..maxLoginAttempts..\"#FFFFFF]\",source,255,255,255,true)\r\n\t\t\t\t\t\tsetTimer(outputChatBox,1000,1,\"#0000FF* #FFFFFFYou will be kicked in #008AFF5 seconds#FFFFFF!\",source,255,255,255,true)\r\n\t\t\t\t\t\tsetTimer(kickPlayer,5000,1,source,\"Failed to login\")\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\toutputChatBox (\"#0000FF* #FFFFFFError! Wrong username and/or password!\",source,255,255,255,true)\r\n\t\t\t\t\t\tsetTimer(outputChatBox,500,1,\"#0000FF* #FFFFFFLogin attempts: [#008AFF\"..attemptedLogins+1 ..\"/\"..maxLoginAttempts..\"#FFFFFF]\",source,255,255,255,true)\r\n\t\t\t\t\t\ttriggerClientEvent(source,\"onRequestIncreaseAttempts\",source)\r\n\t\t\t\t\tend\r\n\t\t\t\telse\r\n\t\t\t\t\toutputChatBox (\"#0000FF* #FFFFFFError! Wrong username and/or password!\",source,255,255,255,true)\r\n\t\t\t\tend\r\n\t\t\tend\r\n\t\telse\r\n\t\t\toutputChatBox (\"#0000FF* #FFFFFFError! Please enter your password!\",source,255,255,255,true)\r\n\t\tend\r\n\telse\r\n\t\toutputChatBox (\"#0000FF* #FFFFFFError! Please enter your username!\",source,255,255,255,true)\r\n\tend\r\nend\r\n\r\n-- Registration here\r\nfunction registerPlayer(username,password,passwordConfirm)\r\n\tif not (username == \"\") then\r\n\t\tif not (password == \"\") then\r\n\t\t\tif not (passwordConfirm == \"\") then\r\n\t\t\t\tif password == passwordConfirm then\r\n\t\t\t\t\tlocal account = getAccount (username,password)\r\n\t\t\t\t\tif (account == false) then\r\n\t\t\t\t\t\tlocal accountAdded = addAccount(tostring(username),tostring(password))\r\n\t\t\t\t\t\tif (accountAdded) then\r\n\t\t\t\t\t\t\ttriggerClientEvent(source,\"hideRegisterWindow\",getRootElement())\r\n\t\t\t\t\t\t\toutputChatBox (\"#0000FF* #FFFFFFYou have sucessfuly registered! [Username: #ABCDEF\" .. username .. \" #FF0000| #FFFFFFPassword: #ABCDEF\" .. password .. \"#FFFFFF]\",source,255,255,255,true )\r\n\t\t\t\t\t\t\tsetTimer(outputChatBox,800,1,\"#0000FF* #FFFFFFYou can now login with your new account.\",source,255,255,255,true )\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\toutputChatBox (\"#0000FF* #FFFFFFAn unknown error has occured! Please choose a different username/password and try again.\",source,255,255,255,true )\r\n\t\t\t\t\t\tend\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\toutputChatBox (\"#0000FF* #FFFFFFError! An account with this username already exists!\",source,255,255,255,true )\r\n\t\t\t\t\tend\r\n\t\t\t\telse\r\n\t\t\t\t\toutputChatBox (\"#0000FF* #FFFFFFError! Passwords do not match!\",source,255,255,255,true)\r\n\t\t\t\tend\r\n\t\t\telse\r\n\t\t\t\toutputChatBox (\"#0000FF* #FFFFFFError! Please confirm your password!\",source,255,255,255,true)\r\n\t\t\tend\r\n\t\telse\r\n\t\t\toutputChatBox (\"#0000FF* #FFFFFFError! Please enter a password!\",source,255,255,255,true)\r\n\t\tend\r\n\telse\r\n\t\toutputChatBox (\"#0000FF* #FFFFFFError! Please enter a username you would like to register with!\",source,255,255,255,true)\r\n\tend\r\nend\r\n\r\n-- Auto-login handling\r\nfunction autologinPlayer(username,password)\r\n\tif not (username == \"\") then\r\n\t\tif not (password == \"\") then\r\n\t\t\tlocal account = getAccount ( username, password )\r\n\t\t\tif not (account == false) then\r\n\t\t\t\tlogIn (source, account, password)\r\n\t\t\t\toutputChatBox(\"#0000FF* #FFFFFFYou have been automatically logged in.\",source,255,255,255,true)\r\n\t\t\t\tsetTimer(outputChatBox,1000,1,\"#0000FF* #FFFFFFTo disable auto-login, use #ABCDEF/disableauto.\",source,255,255,255,true)\r\n\t\t\t\ttriggerClientEvent ( source, \"hideLoginWindow\", getRootElement())\r\n\t\t\telse\r\n\t\t\t\toutputChatBox (\"#FF0000* #FFFFFFAuto-login error - Username & password do not match\",source,255,255,255,true)\r\n\t\t\tend\r\n\t\telse\r\n\t\t\toutputChatBox (\"#FF0000* #FFFFFFAuto-login error - Failed to retrieve password\",source,255,255,255,true)\r\n\t\tend\r\n\telse\r\n\t\toutputChatBox (\"#FF0000* #FFFFFFAuto-login error - Failed to retrieve username\",source,255,255,255,true)\r\n\tend\r\nend\r\n\r\n-- When the player logs out, trigger the client event to check if the login panel will request them to login again\r\nfunction logoutHandler()\r\n\ttriggerClientEvent(source,\"onRequestDisplayPanel\",source)\r\nend\r\naddEventHandler(\"onPlayerLogout\",getRootElement(),logoutHandler)\r\n\r\n-- Get the server's name\r\nfunction getData()\r\n\tlocal sName = md5(getServerName())\r\n\tlocal sName = string.sub(sName,0,15)\r\n\ttriggerClientEvent(source,\"onGetServerData\",getRootElement(),sName)\r\nend\r\n\r\naddEvent(\"onRequestLogin\",true)\r\naddEvent(\"onRequestRegister\",true)\r\naddEvent(\"onRequestAutologin\",true)\r\naddEvent(\"onClientLoginLoaded\",true)\r\naddEventHandler(\"onRequestLogin\",getRootElement(),loginPlayer)\r\naddEventHandler(\"onRequestRegister\",getRootElement(),registerPlayer)\r\naddEventHandler(\"onRequestAutologin\",getRootElement(),autologinPlayer)\r\naddEventHandler(\"onClientLoginLoaded\",getRootElement(),getData)"]],"start1":0,"start2":0,"length1":0,"length2":5323}]],"length":5323}
